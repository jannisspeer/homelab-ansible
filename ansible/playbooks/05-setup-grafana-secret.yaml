---
- name: Setup Grafana Admin Credentials Secret
  hosts: control_plane[0]
  vars_files:
    - ../secrets/grafana_secrets.yaml
  environment:
    KUBECONFIG: /home/{{ ansible_user }}/.kube/config
  tasks:
    - name: Ensure monitoring namespace exists
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Namespace
          metadata:
            name: monitoring

    - name: Create grafana-admin-credentials secret in monitoring namespace
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Secret
          metadata:
            name: grafana-admin-credentials
            namespace: monitoring
          type: Opaque
          stringData:
            admin-user: admin
            admin-password: "{{ grafana_admin_credentials }}"
